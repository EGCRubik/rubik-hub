{% extends "base_template.html" %}

{% block title %}Repository record{% endblock %}

{% block content %}
<div class="container mt-3">
  <h1 class="h3">Repository record</h1>

  {% if dataset %}
  <div class="mb-3">
    <h2 class="h5">Dataset</h2>
    <ul class="list-unstyled">
      <li><strong>ID:</strong> {{ dataset.id }}</li>
      <li><strong>Title:</strong> {{ dataset.ds_meta_data.title }}</li>
      <li><strong>Description:</strong> {{ dataset.ds_meta_data.description }}</li>
      <li><strong>Tags:</strong> {{ dataset.ds_meta_data.tags }}</li>
    </ul>
  </div>
  {% endif %}

  {% if record %}
  <div class="mb-3">
    <h2 class="h5">Fakenodo</h2>
    <ul class="list-unstyled">
      <li><strong>ID:</strong> {{ record.id }}</li>
      <li><strong>Status:</strong> <span class="badge {{ 'bg-success' if record.status=='published' else 'bg-warning text-dark' }}">{{ record.status }}</span></li>
      <li><strong>DOI:</strong> {{ record.doi }}</li>
    </ul>
    <h3 class="h6 mt-3">Metadata</h3>
    {% set meta = record.metadata or {} %}
    {% set versions = meta.get('versions', []) %}
  {% if versions and versions|length > 0 %}
    <div class="card mb-3">
      <div class="card-header">Versions</div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm mb-0">
            <thead>
              <tr>
                <th scope="col">Version</th>
                <th scope="col">DOI</th>
                <th scope="col">Created at</th>
              </tr>
            </thead>
            <tbody>
              {% for v in versions %}
              <tr>
                <td>{{ v.version }}</td>
                <td>{{ v.doi }}</td>
                <td>{{ v.created_at }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    {% endif %}

    <pre class="bg-light p-2 border rounded" style="white-space: pre-wrap;">{{ meta | tojson(indent=2) }}</pre>
  </div>
  {% else %}                                                                                                                    
  <div class="alert alert-warning">No record found for this DOI.</div>
  {% endif %}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         

  <div class="mt-3">
    {% if dataset %}
    <a href="{{ url_for('dataset.subdomain_index', dataset_id=dataset.id) }}" class="btn btn-secondary btn-sm">View dataset</a>
    {% endif %}                                     
    <a href="{{ url_for('dataset.list_dataset') }}" class="btn btn-outline-secondary btn-sm">Back to list</a>
  </div>
</div>
{% endblock %}
                                                                                                                                